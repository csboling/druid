name: standalone druid executables
on: [pull_request]

jobs:
  build:
    strategy:
      matrix:
        platform: [ubuntu-latest, macos-latest, windows-latest]
    steps:
    - uses: actions/checkout@v1
    - name: set up python
      uses: actions/setup-python@v1
      with:
        python-version: 3.7
    - name: install deps
      run: |
        python -m pip install --upgrade pip
	pip install --upgrade setuptools
	pip install pyinstaller
    - name: build in venv
      run: |
        python -m venv .venv
	source bin/activate
	python setup.py install
	pyinstaller -n druid src/druid/main.py
        zip -r druid.zip dist/druid
    # - name: create release
    #   id: create-release
    #   uses: actions/create-release@master
    #   env:
    #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    #   with:
    #     tag_name: ${{ github.ref }}
    #     release_name: Release ${{ github.ref }}
    #     draft: false
    #     prerelease: false
    # - name: upload release assets
    #   id: upload-release-asset
    #   uses: actions/upload-release-asset@v1.0.0
    #   env:
    #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    #   with:
    # 	upload_url: ${{ steps.create_release.outputs.upload_url }}
    #       asset_path: ./druid.zip
    #       asset_name: druid.zip
    #       asset_content_type: application/zip